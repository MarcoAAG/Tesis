\chapter{Modelo matemático}
\cleanchapterquote{In mathematics, you don’t understand things. You just get used to them.}{John von Neumann}{(mathematician, physicist, computer scientist, and polymath.)}

En el presente capitulo se aborda el modelo matemático para el seguimiento de objetivos de una gimbal embebida en un UAV.

% ---------------------------------------------------------------------------------------------------------
% *********************************************************************************************************
% *********************************************************************************************************
% ---------------------------------------------------------------------------------------------------------
\section{Marco de referencia}
Hay un concepto clave que ayuda establecer la bases para la comprensión del movimiento de
un cuerpo rígido, que es el de marco de referencia.\\
En la siguiente imagen asociamos con cualquier posición y orientación un marco de referencia
\begin{center}
	\includegraphics[width=0.55\textwidth]{Contenido/Cuerpo/Capitulo3/Fig10.eps}
	\captionof{figure}{Desplazamiento cuerpo rigido}
	\label{fig:ModeloMat:Fig1}
\end{center}
En el marco A, podemos encontrar 3 vectores linealmente independientes $a_1$, $a_2$ y $a_3$
y de la misma manera en el marco B tenemos tres vectores $b_1$, $b_2$ y $b_3$, podemos
escribir cualquier vector como una combinación lineal del vector base en cualquier marco
\begin{equation}
	\textbf{v} = v_1 \textbf{a}_1 + v_2 \textbf{a}_2 + v_3 \textbf{a}_3
\end{equation}
Tales vectores pueden ser vistos como ortogonales y si aplicamos una rotación del marco A
la transformación g queda ilustrada en la siguiente figura.
\begin{center}
	\includegraphics[width=0.55\textwidth]{Contenido/Cuerpo/Capitulo3/Fig11.eps}
	\captionof{figure}{Desplazamiento cuerpo rigido}
	\label{fig:ModeloMat:Fig1}
\end{center}
Podemos escribir ambos vectores ortogonales unitarios en un solo marco de referencia como
una combinacipon lineal de ambos
\begin{subequations}
	\begin{equation}
		\textbf{b}_1 = R_{11}\textbf{a}_1 + R_{12}\textbf{a}_2 + R_{13}\textbf{a}_3
	\end{equation}
	\begin{equation}
		\textbf{b}_2 = R_{21}\textbf{a}_1 + R_{22}\textbf{a}_2 + R_{23}\textbf{a}_3
	\end{equation}
	\begin{equation}
		\textbf{b}_3 = R_{31}\textbf{a}_1 + R_{32}\textbf{a}_2 + R_{33}\textbf{a}_3
	\end{equation}
\end{subequations}
Para este caso se escoge \textbf{b}$_1$, \textbf{b}$_2$ y \textbf{b}$_3$ como la combinación
lineal para \textbf{a}$_1$, \textbf{a}$_2$ y \textbf{a}$_3$ y los coeficientes de R se
pueden acomodar en un arreglo de 3x3 llamada matriz de rotación
\begin{equation}
	R=
	\begin{bmatrix}
		R_{11} & R_{12} & R_{13} \\
		R_{21} & R_{22} & R_{23} \\
		R_{31} & R_{32} & R_{33}
	\end{bmatrix}
\end{equation}
Y las propiedades de esta matriz son las siguientes
\begin{itemize}
	\item Ortogonal
	\item Su determínate es +1
	\item El producto de dos matrices de rotación da como resultado otra matriz de rotación
	\item La inversa de una matriz de rotación es también una matriz de rotación
\end{itemize}
La importancia de las matrices de rotación radican en que con ayuda de software y hardware
podemos aplicar técnicas de mapeo y simulación, además de que para el sistema de la gimbal
entra en juego múltiples marcos de referencia que constantemente cambian su orientación y
desplazamiento.\\
Ahora bien si trazamos un vector Q en cada marco de referencia como en la siguiente imagen
\begin{center}
	\includegraphics[width=0.75\textwidth]{Contenido/Cuerpo/Capitulo3/Fig12.eps}
	\captionof{figure}{Vectores de rotación}
	\label{fig:ModeloMat:Fig1}
\end{center}
Si trasladamos el marco B en A podremos obtener de nuevo una combinación lineal pero con
diferentes conjuntos de coeficientes
\begin{equation}
	\overrightarrow{PQ} = q_1\textbf{a}_1 + q_2\textbf{a}_2 + q_3\textbf{a}_3
\end{equation}
\begin{equation}
	\overrightarrow{PQ'} = q'_1\textbf{a}_1 + q'_2\textbf{a}_2 + q'_3\textbf{a}_3
\end{equation}
La matriz que conecta $q_1$, $q_2$ y $q_3$ con $q'_1$ , $q'_2$ y $q'_3$ es la matriz de
rotación vista en la ecuación 3.3
\begin{equation}
	\begin{bmatrix}
		q_1 \\
		q_2 \\
		q_3
	\end{bmatrix}
	=
	\begin{bmatrix}
		R_{11} & R_{12} & R_{13} \\
		R_{21} & R_{22} & R_{23} \\
		R_{31} & R_{32} & R_{33}
	\end{bmatrix}
	\begin{bmatrix}
		q'_1 \\
		q'_2 \\
		q'_3
	\end{bmatrix}
\end{equation}
Dicha matriz nos dice como se transforman los vectores de un marco de referencia a otro.

Los movimientos de la gimbal se basan en las coordenadas horizontales de azimuth y elevación, para gimbal de 3 grados de libertad
se agrega un tercer eje cuyo movimiento se conoce como roll. El eje de azimuth y la elevación se visualizan más fácilmente al
pensar en la posición de un objeto en relación con el horizonte.
\begin{center}
	\includegraphics[width=0.55\textwidth]{Contenido/Cuerpo/Capitulo3/Fig1.eps}
	\captionof{figure}{Angulo de azimuth}
	\label{fig:ModeloMat:Fig1}
\end{center}
El angulo de azimuth es la posición alrededor del horizonte, medida desde un punto de referencia como el norte verdadero o el sur
verdadero. Los movimientos de azimuth ocurren alrededor del eje Z (vertical).

La elevación es la distancia del objeto por encima o por debajo del horizonte (también conocida como altitud en aplicaciones de
astronomía y aeroespaciales). Los movimientos de elevación ocurren alrededor del eje Y.

Los movimientos de balanceo ocurren alrededor del eje X a medida que gira con los ejes Y y Z.\\
El control que se hace en la gimbal está dado por un motor con control de posición y una IMU (sensor inercial).Dicha gimbal esta
montada en la parte delantera del vehículo aéreo como se muestra en la siguiente figura.
\begin{center}
	\includegraphics[width=0.55\textwidth]{Contenido/Cuerpo/Capitulo3/Fig2.eps}
	\captionof{figure}{Seguimiento de un objetivo utilizando una cámara sujeta a una gimbal embebida en un vehículo aéreo no tripulado.}
	\label{fig:ModeloMat:Fig1}
\end{center}

\subsection{Marco de referencia Inercial [I]}
Antes de abordar el control de la gimbal, es necesario y obvio conocer el comportamiento
de dicho sistema, empezaremos por definir el marco de referencia inercial, es decir
el de la tierra. La siguiente imagen ilustra los ejes de este marco.
\begin{center}
	\includegraphics[width=0.25\textwidth]{Contenido/Cuerpo/Capitulo3/Fig4.eps}
	\captionof{figure}{Marco de referencia inercial}
	\label{fig:ModeloMat:Fig1}
\end{center}
Donde definimos a k apuntando hacia el centro de la tierra, este sistema de coordenadas
refieren a (Norte, Este y Abajo) de ahí su nombre NED(siglas en inglés).

\subsection{Marco de referencia del cuerpo [B]}
Una aeronave tiene la libertad de rotar en 3 ejes, en la aeronáutica son conocidos como
Yaw, Pitch y Roll. Dichas rotaciones son importantes en el control de aeronaves ya
que sirven para conocer la dinámica del sistema, dicha rotaciones pueden ser mejor
detalladas en una imagen, por lo que en la siguiente ilustración se grafica un plano
y se asigna nombre a cada rotación de los ejes.
\begin{center}
	\includegraphics[width=0.35\textwidth]{Contenido/Cuerpo/Capitulo3/Fig6.eps}
	\captionof{figure}{Rotación en 3 ejes.}
	\label{fig:ModeloMat:Fig1}
\end{center}
Vamos a llamar marco de referencia del cuerpo a las coordenadas del UAV, es necesario establecer el centro del plano en el
centro de masas de la aeronave, como se ilustra en la siguiente figura.
\begin{center}
	\includegraphics[width=0.5\textwidth]{Contenido/Cuerpo/Capitulo3/Fig5.eps}
	\captionof{figure}{Marco de referencia del cuerpo.}
	\label{fig:ModeloMat:Fig1}
\end{center}
De donde definimos las dos rotaciones que seran controladas en este trabajo pitch y yaw($\theta$, $\psi$). El subíndice B hace referencia
a Body y nos indica que estamos hablando de las coordenadas del UAV.

\subsection{Marco de referencia de la gimbal [G]}
Un último paso es definir un marco de referencia para la cámara, considerando que la cámara se encuentra en la parte delantera de
la aeronave y que el centro de la gimbal es el origen.
\begin{center}
	\includegraphics[width=0.3\textwidth]{Contenido/Cuerpo/Capitulo3/Fig7.eps}
	\captionof{figure}{Marco de referencia del la cámara.}
	\label{fig:ModeloMat:Fig1}
\end{center}
De donde el subíndice G hace referencia a que estamos en el plano de la gimbal. El vector unitario K apunta hacia afuera,
es decir hacia nosotros.


\section{Modelo matematico gimbal}
Poniendo en el mismo plano dos referencias, el de la gimbal y el del body, tal como se ilustra en la siguiente figura
\begin{center}
	\includegraphics[width=0.3\textwidth]{Contenido/Cuerpo/Capitulo3/Fig8.eps}
	\captionof{figure}{Marco de referencia Body y gimbal}
	\label{fig:ModeloMat:Fig1}
\end{center}
Cualquier punto en el plano puede ser expresado como:
\begin{equation}
	p_{i^B,j^B} = [p_i^B , p_j^B]^T = p_i i^B + p_j p^B
\end{equation}
\begin{equation}
	p_{i^G,j^G} = [p_i^G , p_j^G]^T = p_i \cdot i^G + p_j\cdot  p^G
\end{equation}
\begin{equation}
	\textbf{P}_{i,j}^B = \textbf{P}_{i,j}^G
\end{equation}

Si hacemos rotar el frame de la gimbal respecto al eje K obtenemos que:
\begin{center}
	\includegraphics[width=0.3\textwidth]{Contenido/Cuerpo/Capitulo3/Fig9.eps}
	\captionof{figure}{Rotación del marco de referencia Gimbal respecto al del cuerpo}
	\label{fig:ModeloMat:Fig1}
\end{center}
\begin{equation}
	p_{i^B,j^B} = [p_i^B , p_j^B]^T = p_i i^B + p_j p^B
\end{equation}
\begin{equation}
	p_{i^G,j^G} = [p_i^G , p_j^G]^T = p_i i^G + p_j p^G
\end{equation}
Como
\begin{equation}
	p_i = p_{i,j}^G \cdot i^B = p_i^G i^B \cdot i^G + p_j^G i^B \cdot j^G
\end{equation}
\begin{equation}
	p_j = p_{i,j}^G \cdot j^B = p_i^G j^B \cdot i^G + p_j^G j^B \cdot j^G
\end{equation}
Entonces
\begin{equation*}
	\begin{bmatrix}
		p_i^B \\
		p_j^B
	\end{bmatrix}
	=
	R
	\begin{bmatrix}
		p_i^G \\
		p_j^G
	\end{bmatrix}
\end{equation*}
Donde la matriz de rotación etsa dada por:
\begin{equation*}
	R=
	\begin{bmatrix}
		i^B\cdot i^G & i^B \cdot j^G \\
		j^B\cdot i^G & j^B \cdot j^G
	\end{bmatrix}
	=
	\begin{bmatrix}
		cos(\psi) & -sin(\psi) \\
		sin(\psi) & cos(\psi)
	\end{bmatrix}
\end{equation*}

% ---------------------------------------------------------------------------------------------------------
% *********************************************************************************************************
% *********************************************************************************************************
% ---------------------------------------------------------------------------------------------------------
\section{Modelo matemático del motor DC}
Los actuadores del sistemas son un apr de motores de corriente directa.